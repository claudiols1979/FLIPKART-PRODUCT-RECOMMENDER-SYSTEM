version: '3.8'
services:
  flask-app:
    build: .  # Uses your Dockerfile
    image: flask-app:latest
    container_name: flask-container
    ports:
      - "5000:5000"  # Map host port 5000 to container port 5000
    env_file:
      - .env  # Loads all your API keys and tokens
    # Add additional environment variables if needed
    environment:
      - FLASK_APP=app.py
      - FLASK_ENV=development  # or production
      - PYTHONPATH=/app
    volumes:
      # For development - mount code for hot reload
      - .:/app
      # Exclude Python cache files
      - /app/__pycache__
    # For debugging or interactive shell access
    stdin_open: true
    tty: true
    # Health check to ensure app is running
    healthcheck:
      test: ["CMD", "python", "-c", "import requests; requests.get('http://localhost:5000/health', timeout=2) || exit(1)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    # Restart policy (similar to k8s)
    restart: unless-stopped
    # If you need to limit resources (matching k8s resources)
    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M

  # Optional: Add a database if your Flask app needs one
  # postgres:
  #   image: postgres:15-alpine
  #   environment:
  #     - POSTGRES_DB=llmops
  #     - POSTGRES_USER=admin
  #     - POSTGRES_PASSWORD=admin123
  #   ports:
  #     - "5432:5432"
  #   volumes:
  #     - postgres_data:/var/lib/postgresql/data
  #   healthcheck:
  #     test: ["CMD-SHELL", "pg_isready -U admin"]
  #     interval: 10s
  #     timeout: 5s
  #     retries: 5

# volumes:
#   postgres_data: